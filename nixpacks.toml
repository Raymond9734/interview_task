[phases.setup]
nixPkgs = [
  'postgresql',
  'vips'
]

[phases.setup.nodejs]
version = "18.19.0"
nodeEnv = "production"

# Set the working directory
workdir = "/app"

# Simple copy phase - copy everything
[phases.copy]
path = "."

[phases.install]
cmds = [
  'cd /app',
  'npm config set legacy-peer-deps true',
  'npm install --omit=dev',
  'bundle config set --local path "vendor/bundle"',
  'bundle install --deployment --without development test'
]

# Build phase is now handled by railway.json
[phases.build]
cmds = []

# Start command is now handled by railway.json
[variables]
NODE_ENV = "production"
RAILS_ENV = "production"